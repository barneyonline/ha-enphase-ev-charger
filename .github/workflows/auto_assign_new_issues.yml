name: Auto Assign New Issues

on:
  issues:
    types: [opened]

permissions:
  issues: write

jobs:
  assign_to_author:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const { owner, repo } = context.repo;
            const issue = context.payload.issue;
            const login = "barneyonline";

            if (issue.assignees?.some((assignee) => assignee.login === login)) {
              return;
            }

            await github.rest.issues.addAssignees({
              owner,
              repo,
              issue_number: issue.number,
              assignees: [login],
            }).catch((error) => {
              if (error.status !== 422) {
                throw error;
              }
            });
